package org.example;

import java.sql.*;

public class Main {
    public static void main(String[] args) throws ClassNotFoundException {
        String driverName = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
        Class.forName(driverName);

        String url = "jdbc:sqlserver://localhost\\MSSQLSERVER01;databaseName=Employee;integratedSecurity=true;encrypt=true;trustServerCertificate=true";

        try (Connection connection = DriverManager.getConnection(url)) {
            System.out.println("Connected to the database.");

            // Enable IDENTITY_INSERT for the table
            String enableIdentityInsertSQL = "SET IDENTITY_INSERT rev_interns ON";
            try (Statement enableStatement = connection.createStatement()) {
                enableStatement.executeUpdate(enableIdentityInsertSQL);
            } catch (SQLException e) {
                System.out.println("Failed to enable IDENTITY_INSERT. Error: " + e.getMessage());
                return; // Exit the method if enabling IDENTITY_INSERT fails
            }

            // Insert values into the rev_interns table with column names specified
            String insertSQL = "INSERT INTO rev_interns (interid,intern_name,city,age,salary,adhar_no) VALUES (?, ?, ?, ?, ?, ?)";
            try (PreparedStatement preparedStatement = connection.prepareStatement(insertSQL)) {
                // Set values for the parameters
                preparedStatement.setInt(1, 21313);
                preparedStatement.setString(2, "Raj");
                preparedStatement.setString(3, "Chennai");
                preparedStatement.setInt(4, 21);
                preparedStatement.setInt(5, 88000);
                preparedStatement.setInt(6, 33334444);

                // Execute the query
                int rowsInserted = preparedStatement.executeUpdate();
                if (rowsInserted > 0) {
                    System.out.println("A new row has been inserted successfully.");
                }
            } catch (SQLException e) {
                System.out.println("Insertion failed. Error: " + e.getMessage());
            }

            // Disable IDENTITY_INSERT for the table
            String disableIdentityInsertSQL = "SET IDENTITY_INSERT rev_interns OFF";
            try (Statement disableStatement = connection.createStatement()) {
                disableStatement.executeUpdate(disableIdentityInsertSQL);
            } catch (SQLException e) {
                System.out.println("Failed to disable IDENTITY_INSERT. Error: " + e.getMessage());
            }
        } catch (SQLException e) {
            System.out.println("Connection failed. Error: " + e.getMessage());
        }
    }
}
